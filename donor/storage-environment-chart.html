import React from "react";
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Cell,
} from "recharts";

/**
 * ArchivalStorageChart
 *
 * - Responsive, accessible layout matching the toolkit tone
 * - Precomputes range values so Recharts uses simple dataKeys
 * - Custom tooltip that shows original min/max ranges
 */
const ArchivalStorageChart = () => {
  const raw = [
    {
      material: "Paper & Books",
      tempMin: 65,
      tempMax: 70,
      humidityMin: 30,
      humidityMax: 50,
      color: "#8B4513",
    },
    {
      material: "Photographs (B&W)",
      tempMin: 65,
      tempMax: 70,
      humidityMin: 30,
      humidityMax: 40,
      color: "#2C3E50",
    },
    {
      material: "Photographs (Color)",
      tempMin: 35,
      tempMax: 40,
      humidityMin: 30,
      humidityMax: 40,
      color: "#E74C3C",
    },
    {
      material: "Magnetic Media",
      tempMin: 60,
      tempMax: 70,
      humidityMin: 30,
      humidityMax: 50,
      color: "#3498DB",
    },
    {
      material: "Film & Negatives",
      tempMin: 35,
      tempMax: 45,
      humidityMin: 30,
      humidityMax: 40,
      color: "#9B59B6",
    },
    {
      material: "Textiles",
      tempMin: 65,
      tempMax: 70,
      humidityMin: 45,
      humidityMax: 55,
      color: "#16A085",
    },
  ];

  // compute range fields so Recharts can use simple dataKey strings
  const data = raw.map((d) => ({
    ...d,
    tempRange: Math.max(0, d.tempMax - d.tempMin),
    humidityRange: Math.max(0, d.humidityMax - d.humidityMin),
  }));

  // global axis bounds with some padding
  const tempGlobalMin = Math.min(...raw.map((r) => r.tempMin));
  const tempGlobalMax = Math.max(...raw.map((r) => r.tempMax));
  const humidityGlobalMin = Math.min(...raw.map((r) => r.humidityMin));
  const humidityGlobalMax = Math.max(...raw.map((r) => r.humidityMax));

  const tempDomain = [
    Math.floor(tempGlobalMin - 5),
    Math.ceil(tempGlobalMax + 5),
  ];
  const humidityDomain = [
    Math.max(0, Math.floor(humidityGlobalMin - 5)),
    Math.min(100, Math.ceil(humidityGlobalMax + 5)),
  ];

  // Custom tooltip that displays the friendly ranges and respects color coding
  const CustomTooltip = ({ active, payload }) => {
    if (!active || !payload || !payload.length) return null;
    const item = payload[0].payload;
    // simple styling inline to avoid external CSS dependency
    return (
      <div
        role="tooltip"
        aria-live="polite"
        style={{
          background: "#fff",
          border: "1px solid rgba(0,0,0,0.08)",
          padding: 10,
          borderRadius: 6,
          boxShadow: "0 6px 18px rgba(20,30,50,0.06)",
          fontSize: 13,
          color: "#222831",
        }}
      >
        <div style={{ fontWeight: 700, marginBottom: 6 }}>{item.material}</div>
        <div style={{ marginBottom: 4 }}>
          <strong>Temperature: </strong>
          {item.tempMin}–{item.tempMax}°F
        </div>
        <div>
          <strong>Relative Humidity: </strong>
          {item.humidityMin}–{item.humidityMax}% RH
        </div>
      </div>
    );
  };

  return (
    <section
      aria-labelledby="archival-storage-chart-title"
      style={{
        background: "linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,252,0.98))",
        padding: 18,
        borderRadius: 10,
        boxShadow: "0 6px 18px rgba(20,30,50,0.06)",
        color: "var(--text, #222831)",
        fontFamily: '"Open Sans", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial',
      }}
    >
      <h3 id="archival-storage-chart-title" style={{ margin: 0, color: "var(--accent-2, #1f416f)" }}>
        Archival Storage Environment Standards
      </h3>
      <p style={{ marginTop: 8, marginBottom: 16 }}>
        Recommended temperature and relative-humidity ranges for common archival materials. These ranges support
        long-term stability and slow chemical deterioration.
      </p>

      {/* Temperature chart */}
      <div style={{ height: 300, marginBottom: 24 }}>
        <div style={{ fontWeight: 600, marginBottom: 8 }}>Temperature Ranges (°F)</div>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart
            layout="vertical"
            data={data}
            margin={{ top: 8, right: 12, left: 12, bottom: 8 }}
            role="img"
            aria-label="Temperature ranges chart showing recommended temperature ranges per material"
          >
            <CartesianGrid strokeDasharray="3 3" vertical={false} />
            <XAxis
              type="number"
              domain={tempDomain}
              tickCount={6}
              label={{ value: "°F", position: "insideBottomRight", offset: -8 }}
            />
            <YAxis type="category" dataKey="material" width={180} />
            <Tooltip content={<CustomTooltip />} />
            {/* tempMin acts as the offset, make it transparent */}
            <Bar dataKey="tempMin" stackId="temp" fill="transparent" isAnimationActive={false} />
            <Bar dataKey="tempRange" stackId="temp" isAnimationActive={false} >
              {data.map((entry, idx) => (
                <Cell key={`temp-cell-${idx}`} fill={entry.color} />
              ))}
            </Bar>
          </BarChart>
        </ResponsiveContainer>
      </div>

      {/* Humidity chart */}
      <div style={{ height: 300, marginBottom: 18 }}>
        <div style={{ fontWeight: 600, marginBottom: 8 }}>Relative Humidity Ranges (% RH)</div>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart
            layout="vertical"
            data={data}
            margin={{ top: 8, right: 12, left: 12, bottom: 8 }}
            role="img"
            aria-label="Relative humidity ranges chart showing recommended humidity ranges per material"
          >
            <CartesianGrid strokeDasharray="3 3" vertical={false} />
            <XAxis
              type="number"
              domain={humidityDomain}
              tickFormatter={(v) => `${v}%`}
              tickCount={6}
              label={{ value: "% RH", position: "insideBottomRight", offset: -8 }}
            />
            <YAxis type="category" dataKey="material" width={180} />
            <Tooltip content={<CustomTooltip />} />
            <Bar dataKey="humidityMin" stackId="hum" fill="transparent" isAnimationActive={false} />
            <Bar dataKey="humidityRange" stackId="hum" isAnimationActive={false}>
              {data.map((entry, idx) => (
                <Cell key={`hum-cell-${idx}`} fill={entry.color} />
              ))}
            </Bar>
          </BarChart>
        </ResponsiveContainer>
      </div>

      {/* Key guidelines */}
      <div style={{ marginTop: 8 }}>
        <div style={{ fontWeight: 700, marginBottom: 8 }}>Key Guidelines</div>
        <ul style={{ marginTop: 0 }}>
          <li>Stability matters most. Short-term fluctuations are more damaging than conditions slightly outside an ideal range.</li>
          <li>Cooler for photographic materials and film. Color media and film deteriorate faster at higher temperatures.</li>
          <li>Use continuous monitoring. Deploy data loggers and keep records over time to detect trends and seasonal swings.</li>
          <li>Acclimatize on transfer. Allow materials to adjust slowly if moved between environments with different temperature/humidity.</li>
        </ul>
      </div>
    </section>
  );
};

export default ArchivalStorageChart;
